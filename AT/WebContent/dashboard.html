<link href="css/dashboard_style.css" rel="stylesheet"/>

<div id="hypervisors-infopanel"></div>

<script>
/* function getDummy(){
    var myJSONObject = [{"ip": "sprom@dell-Sprom",
               "cpuinfo" : 91,
               "machines" : [{
                   "status" : "running",
                   "name" : "linx2",
                   "cpustats" : 91
               },
               {
                   "status" : "running",
                   "name" : "server2",
                   "cpustats" : 75
               }]
    },
    {"ip": "pasquale@pasq-VAIO",
        "cpuinfo" : 80,
        "machines" : [{
            "status" : "running",
            "name" : "linx2",
            "cpustats" : 60
        },
        {
            "status" : "running",
            "name" : "server2",
            "cpustats" : 30
        }]
    }];
    return myJSONObject;
}
 */

function getHypervisor(){ 
$.getJSON("HypervisorInfo", function(hvList){
    var hypervisorList = hvList;
    
    html = "<p>Hypervisors disponibili</p>\
        <br><br><div id=\"hypervisormenu\" >";
    for(i=0; i<hypervisorList.length; i++) {
        hypervisor = hypervisorList[i];
        if (hypervisor.status=="online"){
	        if(hypervisor.cpuUsage > WARNING_THRESHOLD && hypervisor.cpuUsage < DANGER_THRESHOLD){
	        	html += "<label style=\"color:black; background:#f89406 !important \">"
	                +hypervisor.ip+" ("+hypervisor.cpuUsage+"%)</label><div><p>";
	                	
	        }
	        else if (hypervisor.cpuUsage >=DANGER_THRESHOLD){
	        	html += "<label style=\"color:black; background:#d2322d !important \">"
	                +hypervisor.ip+" ("+hypervisor.cpuUsage+"%)</label><div><p>";
	            
	        }
	        else {
	        	html += "<label style=\"color:black; background:#47a447 !important \">"
	                +hypervisor.ip+" ("+hypervisor.cpuUsage+"%)</label><div><p>";
	            
	        }
        }
        else 
        	html += "<label>"+hypervisor.ip+" ("+hypervisor.status+")</label><div><p>";
        
        for(j in hypervisor.machines){
            vmachine = hypervisor.machines[j];
            if (vmachine.status=="running"){
            	if (vmachine.cpuUsage > WARNING_THRESHOLD && vmachine.cpuUsage < DANGER_THRESHOLD){
                html += "<button style=\"background:rgba(248, 148, 6, 0.58) !important\"><b>"+vmachine.name+"</b>"+
                " (<i>"+vmachine.status+"</i> <i>"
                		+vmachine.cpuUsage+"%</i>)"+"</button><br>";  }
                else if (vmachine.cpuUsage >= DANGER_THRESHOLD){
                	html += "<button style=\"background: rgba(255, 0, 0, 0.58) !important\"><b>"+vmachine.name+"</b>"+
                    " (<i>"+vmachine.status+"</i> <i>"
                            +vmachine.cpuUsage+"%</i>)"+"</button><br>";
                }
                else html += "<button style=\"background: rgba(28, 229, 28, 0.58) !important\"><b>"+vmachine.name+"</b>"+
                " (<i>"+vmachine.status+"</i> <i>"
                +vmachine.cpuUsage+"%</i>)"+"</button><br>";
            
            }
            else html += "<button><b>"+vmachine.name+"</b> (<i>"+vmachine.status+"</i>)"+"</button><br>";
        }
        html += "</p></div><br><br>";
    }
    
    $("#hypervisors-infopanel").html(html);
    
    $("#hypervisormenu").accordion({
        heightStyle: "content",
        collapsible: true,
        active: false 
    });
    
    $("button").button();
	});
}; 

getHypervisor();
</script>